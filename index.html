<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Map Editor V2.2</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<header>
  <h1>Map Editor</h1>
</header>

<section id="topbar">
  <div id="modes" role="tablist" aria-label="Modes">
    <button class="mode-btn active" data-mode="terrain">Terrain</button>
    <button class="mode-btn" data-mode="units">Units</button>
    <button class="mode-btn" data-mode="forts">Forts</button>
  </div>

  <div id="statusPills">
    <span id="selectedToolLabel" aria-live="polite">Mode: terrain • Tool: floor</span>
    <button id="toggleJsonPanel" title="Afficher/Masquer JSON">JSON</button>
  </div>
</section>

<section id="controls">
  <label>
    W
    <input type="number" id="mapW" value="10" min="5" max="64">
  </label>
  <label>
    H
    <input type="number" id="mapH" value="8" min="5" max="64">
  </label>

  <button id="newMap">New</button>
  <button id="fillMap">Fill</button>
  <button id="clearMap">Clear</button>
</section>

<section id="subtools">
  <div class="toolRow" id="terrainTools">
    <span class="hint">Peinture terrain : sélectionne une tuile dans la palette.</span>
  </div>

  <div class="toolRow hidden" id="unitTools">
    <label>
      Team
      <select id="unitTeam">
        <option value="player">Allié</option>
        <option value="enemy">Ennemi</option>
      </select>
    </label>

    <label>
      Classe
      <select id="unitClass"></select>
    </label>

    <label>
      Lvl
      <input type="number" id="unitLvl" value="1" min="1" max="50" />
    </label>

    <button id="deleteSelectedUnit" class="danger" disabled>Delete Unit</button>
  </div>

  <div class="toolRow hidden" id="fortTools">
    <label>
      Owner
      <select id="fortOwner">
        <option value="enemy">Ennemi</option>
        <option value="player">Allié</option>
      </select>
    </label>

    <button id="deleteSelectedFort" class="danger" disabled>Delete Fort</button>
    <span class="hint">Forts = sources de renforts (règles à ajouter ensuite).</span>
  </div>
</section>

<section id="zoomBar">
  <button id="zoomOut" title="Zoom -">−</button>
  <span id="zoomLabel">100%</span>
  <button id="zoomIn" title="Zoom +">+</button>
  <button id="zoomReset" title="Reset view">Reset</button>
</section>

<canvas id="mapCanvas"></canvas>

<section id="palette"></section>

<section id="io">
  <button id="exportMap">Export JSON (fichier)</button>
  <label class="import">
    Import (fichier)
    <input type="file" id="importMap" accept=".json">
  </label>
</section>

<!-- JSON Panel Copy/Paste -->
<section id="jsonPanel" class="hidden">
  <div class="jsonHeader">
    <strong>JSON (copier / coller)</strong>
    <div class="jsonBtns">
      <button id="copyJson">Copy</button>
      <button id="pasteImportJson" class="primary">Import</button>
      <button id="formatJson">Format</button>
    </div>
  </div>

  <textarea id="jsonText" spellcheck="false"
    placeholder="Colle ici un JSON de map (version 2) puis clique Import."></textarea>

  <div class="jsonFooter">
    <span id="jsonMsg" aria-live="polite"></span>
  </div>
</section>

<script src="tileset.js"></script>
<script src="io.js"></script>
<script src="app.js"></script>
</body>
</html>
